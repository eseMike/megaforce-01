<section class="gallery" aria-labelledby="gallery-title">
  <div class="gallery__container">
    <header class="gallery__head">
      <h2 id="gallery-title" class="gallery__title">
        <span class="gallery__title-hand">{{ resolvedTitle }}</span>
      </h2>
      <nav class="gallery__filters" aria-label="Filtros de galerÃ­a">
        <button
          *ngFor="let tab of tabs"
          class="pill"
          [class.is-active]="activeTab === tab.key"
          type="button"
          (click)="setActiveTab(tab.key)"
        >
          {{ i18n.t(tab.labelKey) }}
        </button>
      </nav>
    </header>

    <!-- Videos tab: CTA to TikTok profile -->
    <ng-container *ngIf="activeTab === 'videos'">
      <div class="gallery__cta">
        <a href="https://www.tiktok.com/@megaforce.01" target="_blank" rel="noopener" class="btn btn--tiktok">
          ðŸŽµ Ver nuestros videos en TikTok
        </a>
      </div>
    </ng-container>

    <div class="gallery__grid" role="list">
      <!-- Photos tab (grid) -->
      <ng-container *ngIf="activeTab === 'photos'">
        <article class="gallery-card" role="listitem"
                 *ngFor="let item of currentItems">
          <img class="gallery-card__image"
               [src]="item.src"
               [alt]="item.alt || item.title"
               loading="lazy"
               (error)="item.src='fallback.jpeg'" />
          <span class="gallery-card__frame"></span>
          <div class="gallery-card__body">
            <h3 class="gallery-card__title" *ngIf="item.title">{{ item.title }}</h3>
          </div>
        </article>
      </ng-container>


      <!-- Packages tab: cada paquete = 2 tarjetas independientes (ficha izquierda, setup derecha) -->
      <ng-container *ngIf="activeTab === 'packages'">
        <ng-container *ngFor="let pack of packages; let i = index">
          <article class="gallery-card gallery-card--contain" role="listitem">
            <img class="gallery-card__image"
                 [src]="'assets/images/' + pack.ficha"
                 [alt]="pack.alt || ('Paquete ' + (i + 1) + ' ficha')"
                 loading="lazy"
                 (error)="pack.ficha='assets/images/fallback.jpeg'" />
            <span class="gallery-card__frame"></span>
          </article>
          <article class="gallery-card gallery-card--contain" role="listitem">
            <img class="gallery-card__image"
                 [src]="'assets/images/' + pack.setup"
                 [alt]="pack.alt || ('Paquete ' + (i + 1) + ' setup')"
                 loading="lazy"
                 (error)="pack.setup='assets/images/fallback.jpeg'" />
            <span class="gallery-card__frame"></span>
          </article>
        </ng-container>
      </ng-container>
    </div>

    <!-- Segunda grilla (idÃ©ntica a la principal) -->
    <div class="gallery__grid gallery__grid--extra" role="list" *ngIf="activeTab === 'photos' && showExtraGrid">
      <article class="gallery-card" role="listitem" *ngFor="let extra of extraItems">
        <img class="gallery-card__image"
             [src]="extra.src"
             [alt]="extra.alt || extra.title"
             loading="lazy"
             (error)="extra.src='fallback.jpeg'" />
        <span class="gallery-card__frame"></span>
        <div class="gallery-card__body">
          <h3 class="gallery-card__title" *ngIf="extra.title">{{ extra.title }}</h3>
        </div>
      </article>
    </div>

    <!-- CTA: Ver mÃ¡s / Ver menos (solo en pestaÃ±a Fotos) -->
    <div class="gallery__cta" *ngIf="activeTab === 'photos'">
      <!-- External link has priority: if provided, always show it -->
      <a *ngIf="moreLinkHref"
         class="btn btn--primary"
         [href]="moreLinkHref"
         target="_blank" rel="noopener">
        {{ moreLinkLabel }}
      </a>

      <!-- Fallback to toggle when no external link is defined -->
      <ng-container *ngIf="!moreLinkHref && !alwaysShowExtra && (extraItems?.length)">
        <button *ngIf="!showMore" class="btn btn--primary" type="button" (click)="toggleMore()">
          Ver mÃ¡s fotos
        </button>
        <button *ngIf="showMore" class="btn" type="button" (click)="toggleMore()">
          Ver menos
        </button>
      </ng-container>
    </div>
  </div>
</section>
